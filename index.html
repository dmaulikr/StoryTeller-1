<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Storyteller by drekka</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Storyteller</h1>
        <p>A logging framework that promotes following threads of data.</p>

        <p class="view"><a href="https://github.com/drekka/StoryTeller">View the Project on GitHub <small>drekka/StoryTeller</small></a></p>


        <ul>
          <li><a href="https://github.com/drekka/StoryTeller/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/drekka/StoryTeller/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/drekka/StoryTeller">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="storyteller" class="anchor" href="#storyteller" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>StoryTeller</h1>

<p><em>A log should tell a story, not drown the reader in irrelevance.</em> </p>

<ul>
<li>
<a href="#installation">Installation</a>

<ul>
<li><a href="#carthage">Carthage</a></li>
<li><a href="#cocoapods">Cocoapods</a></li>
</ul>
</li>
<li><a href="#adding-story-teller-to-your-code">Adding Story Teller to your code</a></li>
<li>
<a href="#logging">Logging</a>

<ul>
<li><a href="#story-teller-keys">Story Teller keys</a></li>
<li><a href="#what-if-the-keys-not-accessible">What if the keys not accessible?</a></li>
</ul>
</li>
<li>
<a href="#configuring-logging">Configuring logging</a>

<ul>
<li><a href="#on-startup">On startup</a></li>
<li><a href="#environment-variables">Environment variables</a></li>
<li><a href="#programmatically">Programmatically</a></li>
<li><a href="#xcodecolors--logging-templates">XCodeColors &amp; Logging templates</a></li>
</ul>
</li>
<li>
<a href="#smart-logging-criteria">Smart Logging Criteria</a>

<ul>
<li><a href="#general-logging">General logging</a></li>
<li><a href="#simple-value-criteria">Simple value criteria</a></li>
<li><a href="#classes-or-protocol-criteria">Classes or Protocol criteria</a></li>
<li><a href="#kvc-property-criteria">KVC Property criteria</a></li>
<li><a href="#runtime-criteria">Runtime criteria</a></li>
</ul>
</li>
<li>
<a href="#execution-blocks">Execution blocks</a>

<ul>
<li><a href="#release-vs-debug">Release vs Debug</a></li>
<li><a href="#async">Async</a></li>
<li>
<a href="#performance">Performance</a>

<ul>
<li><a href="#update---some-bench-marks">Update - some bench marks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#credits">Credits</a></li>
</ul>

<p><a href="https://raw.githubusercontent.com/drekka/StoryTeller/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-lightgrey.svg" alt="GitHub license"></a></p>

<h1>
<a id="wtf---another-logging-framework" class="anchor" href="#wtf---another-logging-framework" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WTF - Another Logging Framework!!!</h1>

<p><em>Yes StoryTeller is a logging framework. But it's nothing like any logging framework you will have used before.</em></p>

<p>Every other logging framework I have ever encountered (Java or Objective-C) follows the same flawed design - <em>Provide the developer with a set of increasing severity levels which they can use to set the important of the text to be logged.</em> </p>

<p>The basic assumption being that it's possible to create meaningful logs based on how important the developer thinks each piece of information is. Here's a typical logging example (using made up code because I don't want to dis anyone else code):</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-c">// Set up logging</span>
Logger *log = Logger sharedInstance];
[<span class="pl-c1">log</span> <span class="pl-c1">setLogLevel:</span>LogLevel.Debug];
<span class="pl-c">// ... </span>
<span class="pl-en">logDebug</span>(<span class="pl-s"><span class="pl-pds">@"</span>Current account number is <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, account.accNumber);</pre></div>

<p>To debug a problem with account 1223334433, the developer has to turn on <code>Debug</code> logging which then prints out every piece of debug level information regardless of whether it relates to account 1223334444 or not. Often creating massive amounts of output which the developer has to wade through to find the few pieces of relevant information. </p>

<p><strong><em>Debugging with Story Teller is completely different</em></strong>. Story Teller throws out the concept of fixed levels of severity, replacing them with a dynamic, query driven logging system that lets the developer specify the data they want to see. The advantage of this is that the log <em>only</em> contains information relevant to the problem being solved. Here's Story Teller's targetted equivalent of the above:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-c">// Setup logging </span>
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>[account].accNumber == 1223334444<span class="pl-pds">"</span></span>);
<span class="pl-c">// ...</span>
<span class="pl-en">STLog</span>(account, <span class="pl-s"><span class="pl-pds">@"</span>Current account number is <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, account.accNumber);</pre></div>

<p>Notice how we can now specify a criteria so that we only see log statements which are relevant to the account we are interested. Now instead of a massive amount of irrelevant information to search through, the entire log is relevant to the task at hand - <strong><em>How cool is that?</em></strong></p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h1>

<h2>
<a id="carthage" class="anchor" href="#carthage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Carthage</h2>

<p><a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a></p>

<p><a href="https://github.com/Carthage/Carthage">Carthage</a> is the recommended method for including Story Teller in your projects. Simply create a  file called <strong><em>CartFile</em></strong> in the root of your project and add this line:</p>

<pre><code>// Pulls the latest version.
github "drekka/StoryTeller"
</code></pre>

<p>Then open a command line and execute this command from the project's root directory:</p>

<pre><code>carthage bootstrap
</code></pre>

<p>This will download and compile the following frameworks:</p>

<ul>
<li><em>/Carthage/Build/iOS/StoryTeller.framework</em></li>
<li><em>/Carthage/Build/tvOS/StoryTeller.framework</em></li>
</ul>

<p>Add the relevant framework as you would any other.</p>

<h2>
<a id="cocoapods" class="anchor" href="#cocoapods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cocoapods</h2>

<p>At the moment I don't support <a href="https://cocoapods.org">Cocoapods</a> as I regard it as as hacky poor quality solution when compared with <a href="https://github.com/Carthage/Carthage">Carthage</a>. If you are familiar with Cocoapods, please feel free to create a pull request with an appropriate pod spec file.</p>

<h1>
<a id="adding-story-teller-to-your-code" class="anchor" href="#adding-story-teller-to-your-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding Story Teller to your code</h1>

<p>Story teller can be added using a module include (Yes this works in Objective-C):</p>

<div class="highlight highlight-source-objc"><pre>@import StoryTeller;</pre></div>

<h1>
<a id="logging" class="anchor" href="#logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging</h1>

<p>Story Teller has one basic logging statement:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STLog</span>(&lt;key&gt;, &lt;message-template&gt;, &lt;args ...&gt;); </pre></div>

<p><code>&lt;key&gt;</code> is an object that can be queried against when turning on logging. <code>&lt;message-template&gt;</code> and <code>&lt;args...&gt;</code> are exactly the same as you would use for <code>NSLog()</code> statements. </p>

<h2>
<a id="story-teller-keys" class="anchor" href="#story-teller-keys" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Story Teller keys</h2>

<p>The core difference between Story Teller and all other logging frameworks is Story Teller's ability to use object as a key for a logging statement. This key can be anything you want - An account object, a user, a class, a string, or any other valid Objective-C object. Whatever makes sense in your app. Here are some examples:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STLog</span>(user, <span class="pl-s"><span class="pl-pds">"</span>User <span class="pl-ii">%</span>@ is logging<span class="pl-pds">"</span></span>, user.<span class="pl-k">id</span>);
<span class="pl-en">STLog</span>(@(EnumValueGUI), "GUI is doing %@ with %@", aGUIValue, anotherGUIVaue);
<span class="pl-en">STLog</span>(currentView, <span class="pl-s"><span class="pl-pds">"</span>GUI is doing something with <span class="pl-ii">%</span>@<span class="pl-pds">"</span></span>, currentView);
<span class="pl-en">STLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>abc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">@"</span>ABC, ha ha ha ha ha<span class="pl-pds">"</span></span>);</pre></div>

<h2>
<a id="what-if-the-keys-not-accessible" class="anchor" href="#what-if-the-keys-not-accessible" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What if the keys not accessible?</h2>

<p>Often you will have logging which does not have access to the object you want to use as a key. For example a method which performs currency conversion probably won't have the account object passed to it. So how do you ensure that the conversion logging is also active when you are debugging an issue for the account. </p>

<p>Story Teller solves this problem with the concept of <strong>Key Scopes</strong>. You can tell it to make a key cover any number of log statements within a particular scope, even if those logging statements are within methods which don't have access to the key. Here's an example:</p>

<div class="highlight highlight-source-objc"><pre>-(<span class="pl-k">void</span>) firstMethod {
    <span class="pl-c1">STStartScope</span>(user);
    [<span class="pl-v">self</span> <span class="pl-c1">doSomething</span>];
}

<span class="pl-c">// .. meanwhile down here</span>
-(<span class="pl-k">void</span>) doSomething {
    <span class="pl-c1">STLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>another key<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Lets log some other information<span class="pl-pds">"</span></span>); 
}</pre></div>

<p>When reporting based on user, the second log statement (key:account) will also be printed because it's within the scope of user.</p>

<p>Scopes follow these rules: </p>

<ul>
<li>Normal Objective-C scopes for variables. This is because under the hood, Story Teller is using a dynamically added variable to detect when the scope ends. Normally this is the end of the current method, loop or if statement. Assume a <code>STScopeStart(...)</code> is a variable declaration and you will ge the idea. </li>
<li>
<p>Story Teller's then includes any called code. So any logging within a method or API is also included with the scope. This enables logging across a wide range of classes to be accessed using one key without having to specifically pass that key around.  </p>

<p>In the above example, any logging with in <code>goDoSomethingWithAccount:</code> will also be logged when logging for the user.</p>
</li>
</ul>

<h1>
<a id="configuring-logging" class="anchor" href="#configuring-logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuring logging</h1>

<h2>
<a id="on-startup" class="anchor" href="#on-startup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On startup</h2>

<p>Story Teller uses a set of options which it obtains via this process on startup:</p>

<ol>
<li>A default setup is first created with no logging active.</li>
<li>Story Teller then searches all bundles in the app for a file called <strong><em>StoryTellerConfig.json</em></strong>. If found this file is read and the base config is updated with any settings it contains.</li>
<li>Finally the process is checked and if any of the arguments set on the process match known keys in the config, then those values are updated.</li>
</ol>

<p>The basic idea is that you can add a <strong><em>StoryTellerConfig.json</em></strong> file to your app to provide the general config you want to run with, and then during development you can override at will by setting arguments in XCode's scheme for your app.</p>

<p>Current the Json file has two settings and looks something like this:</p>

<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>activeLogs<span class="pl-pds">"</span></span>: [
        <span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>,                           <span class="pl-ii">/*</span> <span class="pl-ii">A</span> <span class="pl-ii">specific</span> <span class="pl-ii">string</span> <span class="pl-ii">key</span> <span class="pl-ii">*/</span>
        <span class="pl-c1">12</span>,                              <span class="pl-ii">/*</span> <span class="pl-ii">A</span> <span class="pl-ii">numeric</span> <span class="pl-ii">(Enum?)</span> <span class="pl-ii">key</span> <span class="pl-ii">*/</span>
        <span class="pl-s"><span class="pl-pds">"</span>[User].account.balance &gt; 500<span class="pl-pds">"</span></span>   <span class="pl-ii">/*</span> <span class="pl-ii">Any</span> <span class="pl-ii">account</span> <span class="pl-ii">over</span> <span class="pl-ii">$</span><span class="pl-c1">500</span> <span class="pl-ii">*/</span>
    ],
    <span class="pl-s"><span class="pl-pds">"</span>loggerClass<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>STConsoleLogger<span class="pl-pds">"</span></span>,  <span class="pl-ii">/*</span> <span class="pl-ii">Optional</span> <span class="pl-ii">*/</span>
    <span class="pl-s"><span class="pl-pds">"</span>logLineTemplate<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>{{file}}:{{line}} {{message}}<span class="pl-pds">"</span></span> <span class="pl-ii">/*</span> <span class="pl-ii">Optional</span> <span class="pl-ii">*/</span>
}</pre></div>

<h3>
<a id="settings" class="anchor" href="#settings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Settings</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>activeLogs</td>
<td>A comma separated list of keys to activate. This is the main setting for turning on logging.</td>
</tr>
<tr>
<td>loggerClass</td>
<td>If you want to set a different class for the, use this setting to specify the class. The class must implement <code>&lt;STLogger&gt;</code> and have a no-arg constructor. You only need to put the class name in this setting. Story Teller will handle the rest. By default, Story Teller uses a simple console logger.</td>
</tr>
<tr>
<td>logLineTemplate</td>
<td>The template of each line in the log. See <a href="#xcodecolors-&amp;-logging-templates">XcodeColors &amp; Logging Templates</a> below for details of this value.</td>
</tr>
</tbody>
</table>

<h2>
<a id="environment-variables" class="anchor" href="#environment-variables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment variables</h2>

<p>You can also pass the settings via enviroment variables. For example, you could set them up in an Xcode schema for running the app.</p>

<p><strong>loggerClass</strong> and <strong>logLineTemplate</strong> are settable. To activate a log you use one or more <strong>log</strong> settings. </p>

<h2>
<a id="programmatically" class="anchor" href="#programmatically" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Programmatically</h2>

<p>You can also programmically enable and disable logging as well. To enable logging, use this statement:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(&lt;key&gt;);</pre></div>

<h2>
<a id="xcodecolors--logging-templates" class="anchor" href="#xcodecolors--logging-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>XCodeColors &amp; Logging templates</h2>

<p><a href="https://github.com/robbiehanson/XcodeColors">XCodeColors</a> is an excellant tool for colour coding your XCode console output. Story Teller supports using it to colour code the details and message of the output. In addition, you can also fully customise the layout of the log lines. </p>

<h3>
<a id="xcodecolors" class="anchor" href="#xcodecolors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/robbiehanson/XcodeColors">XCodeColors</a>
</h3>

<p>If you have XcodeColors installed you can use the following setup to configure Story Tellers console logger. This <em>Only</em> works for the <code>STConsoleLogger</code>.</p>

<div class="highlight highlight-source-objc"><pre>((STConsoleLogger *)[STStoryTeller <span class="pl-c1">storyTeller</span>].logger).addXcodeColours = <span class="pl-c1">YES</span>;

<span class="pl-c">// Only need these if you want to change from the default colours. Which are these colours !</span>
((STConsoleLogger *)[STStoryTeller <span class="pl-c1">storyTeller</span>].logger).messageColour = [UIColor <span class="pl-c1">blackColor</span>];
((STConsoleLogger *)[STStoryTeller <span class="pl-c1">storyTeller</span>].logger).detailsColour = [UIColor <span class="pl-c1">lightGrayColor</span>];</pre></div>

<h3>
<a id="customising-the-logging-template" class="anchor" href="#customising-the-logging-template" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Customising the logging template.</h3>

<p>The default template for a logged line looks like this:</p>

<p><code>{{time}} {{function}}:{{line}} {{message}}</code></p>

<p>As you can see it's based on typical <a href="https://mustache.github.io">Moustache templating</a> using curly brackets and keywords to define where to insert various pieces of information. Naturally you can customize this. Here's how:</p>

<div class="highlight highlight-source-objc"><pre>[STStoryTeller <span class="pl-c1">storyTeller</span>].logger.lineTemplate = [<span class="pl-c1">NSString</span> <span class="pl-c1">stringWithFormat:</span><span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%1$@</span><span class="pl-cce">\n</span>   <span class="pl-c1">%2$@</span>:<span class="pl-c1">%3$@</span><span class="pl-pds">"</span></span>, STLoggerTemplateKeyMessage, STLoggerTemplateKeyFunction, STLoggerTemplateKeyLine];</pre></div>

<p>All the above example does is build a new template string using some predefined strings. This is recommended as it's less likely to trigger mistakes. The only required keyword in any template is the <code>STLoggerTemplateKeyMessage</code> (<code>{{message}}</code>). All others are optional. Here's an example of the output from the above setup:</p>

<p><img src="./Example%20log.png" alt="Log output"></p>

<h4>
<a id="template-keywords" class="anchor" href="#template-keywords" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Template keywords</h4>

<table>
<thead>
<tr>
<th>Built in variable</th>
<th>Text value</th>
<th>Inserts a ...</th>
</tr>
</thead>
<tbody>
<tr>
<td>STLoggerTemplateKeyMessage</td>
<td>{{message}}</td>
<td>
<strong><em>(Required)</em></strong> The finished message argument from <code>STLog(...)</code> with all arguments inseted.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyFile</td>
<td>{{file}}</td>
<td>the name of the source code file.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyFunction</td>
<td>{{function}}</td>
<td>A string representation of the method name which generated the log message.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyLine</td>
<td>{{line}}</td>
<td>The line number of the <code>STLog(...)</code> command.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyThreadId</td>
<td>{{threadId}}</td>
<td>The current thread id.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyThreadName</td>
<td>{{threadName}}</td>
<td>he current thread's name.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyTime</td>
<td>{{time}}</td>
<td>The current time.</td>
</tr>
<tr>
<td>STLoggerTemplateKeyTime</td>
<td>{{key}}</td>
<td>The Story Teller <em>key</em> associated with the <code>STLog(...)</code> command.</td>
</tr>
</tbody>
</table>

<h1>
<a id="smart-logging-criteria" class="anchor" href="#smart-logging-criteria" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Smart Logging Criteria</h1>

<p>The <code>activeLogs</code> configuration setting contains an comma seperated list of smart criteria which activate the log statements. The  <code>STStartLogging(&lt;criteria&gt;);</code> Objective-C statement does the same thing, except you can only pass one criteria at a time. </p>

<p>So what are these criteria? Here are the options</p>

<h2>
<a id="general-logging" class="anchor" href="#general-logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>General logging</h2>

<p>First up there are two special logs you can activate:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>LogAll<span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>LogRoots<span class="pl-pds">"</span></span>);</pre></div>

<p><strong><em>LogAll</em></strong> activates all log statements and disregards any other logging criteira. This is literally a turn everything on option so don't expect to use it often and it's not really what Story Teller is about.</p>

<p><strong><em>LogRoots</em></strong> is similar to <em>LogAll</em> except that it only logs when there are not scopes active. The idea is to get a log showing the highlevel activity in the system. So how well it works depends on how well you setup you log statements. LogRoots will also be overridden by LogAll if it is turned on.</p>

<h2>
<a id="simple-value-criteria" class="anchor" href="#simple-value-criteria" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simple value criteria</h2>

<p>When Story Teller encounters a single value in a criteria, it makes the assumption that the same value has been used as a key. Simple values can be either strings or numbers. Using strings mades a good descriptive sense, whilst integers can be a good idea for matching enums. Notice that with strings, if you don't have any white space in the value, you can enter it without quotes. </p>

<p>For example:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STLog</span>(<span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">@"</span>Log some abc stuff<span class="pl-pds">"</span></span>);
<span class="pl-en">STLog</span>(<span class="pl-s"><span class="pl-pds">"</span>GUI System<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">@"</span>Log view @ <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, aRect);
<span class="pl-en">STLog</span>(@(EnumValueX), @"Log related to EnumValueX");</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>abc<span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-cce">\"</span>GUI System<span class="pl-cce">\"</span><span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(@(EnumValueX)); </pre></div>

<h2>
<a id="classes-or-protocol-criteria" class="anchor" href="#classes-or-protocol-criteria" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Classes or Protocol criteria</h2>

<h3>
<a id="instances" class="anchor" href="#instances" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instances</h3>

<p>You can log based on the type of the key used like this:</p>

<p><code>[class-name] | &lt;protocol-name&gt;</code></p>

<p>These will search for any logging where the key is an instance of the class (or is a subclass of it), or an instance that implements the specified protocol. Here's an example:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STLog</span>(User, <span class="pl-s"><span class="pl-pds">@"</span>Log message for a user<span class="pl-pds">"</span></span>);</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>[User]<span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>&lt;Person&gt;<span class="pl-pds">"</span></span>);    <span class="pl-c">/* Assuming User implements Person */</span></pre></div>

<h2>
<a id="kvc-property-criteria" class="anchor" href="#kvc-property-criteria" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>KVC Property criteria</h2>

<p><code>[class-name].keypath op value</code>
<code>&lt;protocol-name&gt;.keypath op value</code></p>

<p>This criteria looks for keys that matches the specified class or protocol, then examine the <code>keypath</code> on the object for the required value. Here are some examples</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>[User].account.name == <span class="pl-cce">\"</span>derek's account<span class="pl-cce">\"</span><span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>[User].account.balance &gt; 500<span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>&lt;Banking&gt;.active == YES<span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>&lt;Banking&gt;.lastLogon == nil<span class="pl-pds">"</span></span>);
<span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>&lt;Banking&gt;.customer != &lt;Banker&gt;<span class="pl-pds">"</span></span>);</pre></div>

<p>As you can see there is a lot of power here to decide what gets logged. Values fall into several types:</p>

<ul>
<li>
<strong>Strings</strong> - any string. Quotes are required if it incudes whitespace.</li>
<li>
<strong>Numbers</strong> - Any number, integer or decimal format. Number queries can use all the standard comparison operators: <strong>==</strong> ,<strong>!=</strong> ,<strong>&lt;</strong> ,<strong>&lt;=</strong> ,<strong>&gt;</strong> or <strong>&gt;=</strong>.</li>
<li>
<strong>nil checks</strong> - 'nil' keyword which checks for nils exactly the same as Objective-C does. Nil checks  can only use the logical operators: <strong>==</strong> and <strong>!=</strong>.</li>
<li>
<strong>type checks</strong> - either a class or protocol declaration. The same way we declare the type of the key being searched.  Type checks can only use the logical operators: <strong>==</strong> and <strong>!=</strong>.</li>
</ul>

<h2>
<a id="runtime-criteria" class="anchor" href="#runtime-criteria" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Runtime criteria</h2>

<p>Sometimes the best object o use for a key is a <code>Class</code> object. Or (rarely) you want to search on a property that returns a Class. In those cases you can use the <strong>is</strong> keyword to tell Story Teller to look for a Class rather than testing an object. </p>

<p>For example:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STLog</span>([User <span class="pl-c1">class</span>], <span class="pl-s"><span class="pl-pds">@"</span>Log message for class<span class="pl-pds">"</span></span>);</pre></div>

<p>Looking for Class or Protocol keys</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>is [User]<span class="pl-pds">"</span></span>);</pre></div>

<p>This difference here is that Story Teller looks for a Class object rather than an instance of the class.</p>

<p>Looking for Class values in properties</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STStartLogging</span>(<span class="pl-s"><span class="pl-pds">@"</span>[User].accountClass is [MerchantAccount]<span class="pl-pds">"</span></span>);</pre></div>

<h1>
<a id="execution-blocks" class="anchor" href="#execution-blocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Execution blocks</h1>

<p>Story Teller has another trick up it's sleeve. Often we want to run a set of statements to assemble some data before logging or even to log a number of statements at once. With other frameworks we have to manually add some boiler plate around the statements to make sure they are not always being executed. Story Teller has a statement built specifically for this purpose:</p>

<div class="highlight highlight-source-objc"><pre><span class="pl-en">STExecuteBlock</span>(&lt;key&gt;, ^(<span class="pl-k">id</span> key) {
     <span class="pl-c">// Statements go here.</span>
});</pre></div>

<p>The block will only be executed if they currently active logging matches the key. This makes it a perfect way to handle larger and more complex logging situations.</p>

<h2>
<a id="release-vs-debug" class="anchor" href="#release-vs-debug" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Release vs Debug</h2>

<p>Story Teller is very much a Debug orientated logger. Is is not designed to be put into production apps. To that effect, it has a strip mode. Simply add this macro to your <strong>Release</strong> macro declarations and all Story Teller loggin will be stripped out, leaving your Release version a lean mean speed machine.</p>

<p>Disable macro name: <strong><code>DISABLE_STORY_TELLER</code></strong></p>

<h2>
<a id="async" class="anchor" href="#async" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Async</h2>

<p>The only time async logging is needed is when logging a massive amount of information to a file. In 30 years of developing I've never seen an instance where a log like this has been of any use. </p>

<p>In addition developers will invaraibly turn off async logging because the delay between an event occuring and the logged statements appearing in the log can be too long and cause the developer to be given a false impression of where the code is at. </p>

<p>Story Teller is built for debugging. Not producing files or winning speed tests. So it does not support async logging.</p>

<h2>
<a id="performance" class="anchor" href="#performance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Performance</h2>

<p>Performance is something that is a factor when logging because logging to the console or a file is inheriantly slow. Other frameworks follow the basic design concept of - <em>That we want to log everything and sort it out later.</em> This is very wasteful. Especially in the mobile world where dumping everything into a file just on the off chance that someone might want to look at it is quite out of the question. </p>

<p>Because Story Teller uses smarter logging techniques, it will often be faster than traditional logging frameworks simply because it produces less output, more than compensating for the extra processing required.</p>

<h3>
<a id="update---some-bench-marks" class="anchor" href="#update---some-bench-marks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update - some bench marks</h3>

<p>I decided to get an idea of how Story Teller actually compared. So I created a test project and put both Story Teller and a <em>Very Popular 3rd party logging framework</em> into it. </p>

<p>I configured the project to log 1,000 lines of text to the console and store the duration of the process. I also made sure that each line of text was different. I then added further processing to do this loop  10 times and average the durations. </p>

<p>I then ran this with the other framework set to 'Debug', and Story Teller configured with a criteria similar to <code>'[Dummy].forbar = YES'</code> with the log key being an instance of class Dummy. Finally I turned off async logging on the other framework as no developer works with it on and Story Teller does not support it. The idea was to make sure that I was comparing oranges with oranges.</p>

<p>The results where suprising. In a straight time run of logging Story Teller was actually <strong>4x faster</strong> than the competitor. This totally surprised me and the only thing I could think of was that the competitor must have a lot of compexity in it that I simply haven't added to Story Teller. But still - <strong><em>4x?</em></strong></p>

<p>I then ran the tests again. This time with all logging turned off. The idea being to see how the embedded code impacted performance of the main code. This time the competitor easily out performed Story Teller. This was expected as the competitor was designed around very fast boolean switches and could optimize out the logging statements. Story Teller on the other hand, has to leave everything in places because the logging decisions are made at runtime and therefore cannot be avoided, even if no logging is actually done. </p>

<p>Still, Story Teller ran the same loop of avg(1,000)x10 very fast. In the region of 0.001 sec per 1,000 log statements (testing the decision making). When logging, it was around 0.1 sec. So even with it's significantly more intelligent logging, it's no slouch.</p>

<h1>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Credits</h1>

<ul>
<li>Thanks to Todd Ditchendorf for <a href="https://github.com/itod/pegkit">PEGKit</a>. I've learned a lot from working with it.</li>
<li>Big Thanks to the guys behind <a href="https://github.com/Carthage/Carthage">Carthage</a> for writing a dependency tool that actual works well with XCode and Git.</li>
<li>Thanks to Mulle Cybernetik for <a href="ocmock.org">OCMock</a>. An outstanding mocking framework for Objective-C that has enabled me to test the un-testable many times.</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/drekka">drekka</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
